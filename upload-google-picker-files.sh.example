#!/bin/bash
# This is a template file. The actual file with real server credentials is:
# upload-google-picker-files.sh (ignored in .gitignore)
# Copy this file to upload-google-picker-files.sh and replace placeholders with actual values.

# Script to upload Google Photos Picker OAuth files to staging and production servers
# Run this from your local machine: ./upload-google-picker-files.sh

set -e  # Exit on error

echo "üì§ Uploading Google Photos Picker OAuth files to servers"
echo "=" | head -c 60; echo ""

# Check if required files exist
if [ ! -f credentials.json ]; then
    echo "‚ùå Error: credentials.json not found"
    exit 1
fi

if [ ! -f token.json ]; then
    echo "‚ö†Ô∏è  Warning: token.json not found"
    echo "   Run 'node setup-google-picker-auth.js' to generate token.json"
    read -p "Continue without token.json? (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

# Server details - REPLACE WITH YOUR ACTUAL VALUES
SERVER="YOUR_USERNAME@YOUR_SERVER_IP"
PORT="YOUR_SSH_PORT"
PROD_DIR="~/YOUR_PRODUCTION_DIRECTORY"
STAGING_DIR="~/YOUR_STAGING_DIRECTORY"

# Function to upload files to server
upload_files_to_server() {
    local SERVER_DIR=$1
    local SERVER_NAME=$2

    echo ""
    echo "üì§ Uploading to ${SERVER_NAME}..."

    # Upload credentials.json
    scp -P ${PORT} credentials.json ${SERVER}:${SERVER_DIR}/credentials.json
    echo "‚úÖ Uploaded credentials.json"

    # Upload token.json if it exists
    if [ -f token.json ]; then
        scp -P ${PORT} token.json ${SERVER}:${SERVER_DIR}/token.json
        echo "‚úÖ Uploaded token.json"
    fi

    echo "‚úÖ Files uploaded to ${SERVER_NAME}"
}

# Ask which servers to update
echo "Which servers do you want to update?"
echo "  1) Production only"
echo "  2) Staging only"
echo "  3) Both (production and staging)"
read -p "Enter choice (1-3): " choice

case $choice in
    1)
        upload_files_to_server "${PROD_DIR}" "Production"
        ;;
    2)
        upload_files_to_server "${STAGING_DIR}" "Staging"
        ;;
    3)
        upload_files_to_server "${PROD_DIR}" "Production"
        upload_files_to_server "${STAGING_DIR}" "Staging"
        ;;
    *)
        echo "‚ùå Invalid choice"
        exit 1
        ;;
esac

echo ""
echo "‚úÖ Done! Files have been uploaded to the selected servers."
echo ""
echo "üìù Next steps:"
echo "   1. Update .htaccess with OAuth environment variables (use upload-google-picker-oauth-env.sh)"
echo "   2. Restart the application on the server"
echo ""

